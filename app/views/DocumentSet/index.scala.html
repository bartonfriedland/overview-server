@(
  user: OverviewUser,
  documentSets: ResultPage[org.overviewproject.tree.orm.DocumentSet],
  jobs: ResultPage[(org.overviewproject.tree.orm.DocumentSetCreationJob,org.overviewproject.tree.orm.DocumentSet,Long)],
  form: controllers.forms.DocumentSetForm.FormType
)(implicit lang: Lang, flash: Flash)

@javascripts = {
  <!--[if lte IE 9]>
    <script src="@routes.Assets.at("javascripts/vendor/progress-polyfill.js").url"></script>
    <script src="@routes.Assets.at("javascripts/vendor/Silverlight.debug.js").url"></script>
    <script src="@routes.Assets.at("javascripts/ext/silverlight-upload-request.js").url"></script>
  <![endif]-->

  @helper.requireJs(core=routes.Assets.at("javascripts/require.js").url, module=routes.Assets.at("javascripts/bundle/DocumentSet/index").url)
}

@jsMessageKeys = @{Seq(
  "views.DocumentSet._dcimport.legend",
  "views.DocumentSet._dcimport.error",
  "views.DocumentSet._dcimport.labels.email",
  "views.DocumentSet._dcimport.labels.password",
  "views.DocumentSet._dcimport.labels.split_documents",
  "views.DocumentSet._dcimport.placeholders.email",
  "views.DocumentSet._dcimport.submit",
  "views.DocumentSet._dcimport.explanation",
  "views.DocumentSet._dcimport.explanation_no_cors",
  "views.DocumentSet._uploadForm.error.SyntaxError",
  "views.DocumentSet._uploadForm.leavePageWarning",
  "views.DocumentSet._documentSet.action_import",
  "views.DocumentSet._documentSet.document_count",
  "views.DocumentSet._share.loading",
  "views.DocumentSet._share.error",
  "views.DocumentSet._share.explanation",
  "views.DocumentSet._share.remove",
  "views.DocumentSet._share.list_header",
  "views.DocumentSet._share.add",
  "views.DocumentSet._share.email_placeholder",
  "views.DocumentSet._share.example_document_set.checkbox_label"
)}

@**** Stupid function needed only because I can't figure out how to pass 2 params in the map call ****@
@displayDocumentSet(documentSet: org.overviewproject.tree.orm.DocumentSet) = {
  @views.html.DocumentSet._documentSet(documentSet, user)
}

@defining(scopedMessages("views.DocumentSet.index")) { m =>
  @main(optionalUser=Some(user), title=m("title"), bodyClass="document-set-index", h1=m("h1"), javascripts=javascripts, jsMessageKeys=jsMessageKeys) {
    @views.html.DocumentSet._import(user, form)

    @if(jobs) {
      <div class="document-set-creation-jobs" data-refresh-url="@routes.ImportJobController.index().url" data-document-set-url-pattern="@routes.DocumentSetController.showJson(0).url">
        <h2>@m("subtitle_jobs")</h2>
        <p class="description">@m("description_jobs")</p>
        <ul class="unstyled">
          @jobs.toIterable.map(Function.tupled(views.html.ImportJob._documentSetCreationJob.apply))
        </ul>
      </div>
    }

    @if(documentSets || jobs) {
      <div class="document-sets">
        <ul class="unstyled">
          @documentSets.map(displayDocumentSet(_))
        </ul>
        @if(documentSets) {
          @helper.Pagination.links(documentSets.pageDetails, (pageNum: Int) => routes.DocumentSetController.index(pageNum).url)
        } else {
          <p class="no-document-sets">@m("no_document_sets")</p>
        }
      </div>


      @views.html.DocumentSet._errorList()
      @views.html.DocumentSet._sharingOptions()
      @views.html.DocumentSet._exportOptions()
    }
  }
}
